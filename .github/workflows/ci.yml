name: CI

# Controls when the workflow will run
on:
  # Triggers the workflow on push or pull request events but only for the master branch
  push:
    branches: [master]
  pull_request:
    branches: [master]

  # Allows you to run this workflow manually from the Actions tab
  workflow_dispatch:

  # Run every day at midnight
  schedule:
    - cron: "0 0 * * *"

jobs:
  build-ubuntu:
    runs-on: ubuntu-latest
    steps:
      # Checks-out your repository under $GITHUB_WORKSPACE, so your job can access it
      - uses: actions/checkout@v2

      - name: Prepare OS for script
        run: |
          cp bash/.bash-powerline.sh ~/.bash-powerline.sh
          cp bash/.bash_profile ~/.bash_profile
          sudo rm -rf /usr/local/n
          export me="$(whoami)"
          sudo chown -R "$me" ~
          sudo chmod -R 777 ~

      - name: Run install script
        run: |
          source ~/.bash_profile
          bash scripts/install.sh

      - name: Stow linter configs
        run: stow vim

      - name: Run quality checks
        run: bash test.sh

  build-mac:
    runs-on: macos-11
    steps:
      # Checks-out your repository under $GITHUB_WORKSPACE, so your job can access it
      - uses: actions/checkout@v2

      - name: Run install script (skip OS stuff)
        run: SKIP_OS_UPDATE=true bash scripts/install.sh

      - name: Stow linter configs
        run: stow vim

      - name: Run quality checks
        run: bash test.sh
